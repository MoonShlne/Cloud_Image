### **学习笔记：Session-Cookie 认证机制详解**



Session-Cookie 认证是一种**有状态 (Stateful)** 的会话管理机制，它通过服务器端存储和客户端标识相结合的方式，来跟踪和验证用户的登录状态。



#### **核心组件**



- **Session**: 一个在**服务器端**创建和存储的数据结构。它用于存放特定用户的信息，例如用户 ID、角色、登录时间等。每个 Session 都有一个唯一的标识符。
- **Session ID**: **Session 的唯一标识符**。它是一个随机生成的、无意义的字符串，用于关联客户端和服务器端的 Session 数据。
- **Cookie**: 存储在**客户端浏览器**中的一小段数据。在这里，它的唯一作用就是存储 `Session ID`。



#### **工作流程 (参照流程图)**



1. **首次请求与 Session 创建**:
   - 当一个客户端（浏览器）首次向服务器发起请求时，服务器会为其创建一个新的、临时的 `Session` 对象。
   - 同时，服务器为这个 `Session` 对象生成一个全局唯一的 `Session ID`。
2. **Session ID 的下发**:
   - 服务器在返回给客户端的 HTTP 响应头 (Response Header) 中，添加一个 `Set-Cookie` 字段。
   - 这个 `Set-Cookie` 字段的内容就是 `Session ID`（例如 `Set-Cookie: JSESSIONID=ABCDEFG12345`）。
3. **客户端存储 Cookie**:
   - 浏览器接收到响应后，会解析 `Set-Cookie` 指令，并将 `Session ID` 作为一个 `Cookie` 条目，存储在本地。这个 Cookie 与服务器的域名是绑定的。
4. **用户登录认证**:
   - 用户在前端页面提交用户名和密码。
   - 浏览器向服务器发送登录请求。因为是向同一个域名发送请求，浏览器会**自动**地将之前存储的那个包含 `Session ID` 的 Cookie，放入本次请求的请求头 (Request Header) 中一并发送。
   - 服务器接收到登录凭据和 `Session ID`，并对用户名和密码进行验证。
5. **Session 状态更新**:
   - 凭据验证成功后，服务器会根据请求中带来的 `Session ID`，找到之前创建的那个临时 `Session` 对象。
   - 然后，服务器将该用户的身份信息（例如用户对象、权限列表等）**存入**这个 `Session` 对象中。至此，服务器端的 Session 就与一个已认证的用户关联了起来。
6. **后续的已认证请求**:
   - 当用户访问需要登录权限的其他页面时，浏览器会继续**自动**地在每个请求头中附带包含 `Session ID` 的 Cookie。
   - 服务器每次收到请求，都会提取出 `Session ID`。
   - 服务器根据 `Session ID` 在自己的内存或存储中查找对应的 `Session` 对象。
   - 如果找到了，并且 `Session` 对象中包含了用户信息，服务器就确认了用户的已登录身份，并处理该请求。

**总结**：在整个流程中，用户的敏感信息（如用户对象）始终**安全地存放在服务器端**。客户端的浏览器只负责保管 `Session ID` 这个无意义的标识符，并通过 Cookie 机制在每次请求时自动将其发送给服务器，作为身份识别的凭证。





![image-20251014124410267](D:\porjects\Cloud_Image\cloud-image\笔记\img\image-20251014124410267.png)